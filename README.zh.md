# ğŸ’¬ èŠå¤©æœºå™¨äººæ¨¡æ¿

ä¸€ä¸ªç®€å•çš„ Streamlit åº”ç”¨ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ OpenAI çš„ GPT-3.5 æ„å»ºèŠå¤©æœºå™¨äººã€‚

[![åœ¨ Streamlit ä¸­æ‰“å¼€](https://static.streamlit.io/badges/streamlit_badge_black_white.svg)](https://chatbot-template.streamlit.app/)

### å¦‚ä½•åœ¨æ‚¨è‡ªå·±çš„æœºå™¨ä¸Šè¿è¡Œ

### å®‰è£…æŒ‡å—

1. **å…ˆå†³æ¡ä»¶å®‰è£…**
- ä»ä»£ç åº“ä¸‹è½½æ‰€æœ‰æ–‡ä»¶å¹¶å°†å®ƒä»¬ä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚
- åœ¨ Visual Studio Code ä¸­æ‰“å¼€è¯¥æ–‡ä»¶å¤¹ã€‚
- å®‰è£… Python 3.12 æˆ– Python 3.14ã€‚
- (1). ä¸‹è½½ Python
- è®¿é—® Python å®˜æ–¹ç½‘ç«™ (https://www.python.org/downloads/windows/) ä¸‹è½½é¡µé¢ã€‚
- &emsp;é€‰æ‹©æœ€æ–°ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ Python 3.12.xï¼‰ï¼Œç„¶åç‚¹å‡»â€œä¸‹è½½ Windows å®‰è£…ç¨‹åºï¼ˆ64 ä½/32 ä½ï¼‰â€ã€‚
- &emsp;è¿è¡Œå®‰è£…ç¨‹åº<br>
![images](images/03.png)
- (2). åŒå‡»ä¸‹è½½çš„ .exe æ–‡ä»¶ã€‚
- &emsp;å‹¾é€‰â€œå°† Python æ·»åŠ åˆ° PATHâ€ï¼ˆé‡è¦ï¼å¦åˆ™ï¼Œæ‚¨éœ€è¦æ‰‹åŠ¨é…ç½®ç¯å¢ƒå˜é‡ï¼‰ã€‚<br>
![images](images/04.png)
- &emsp;ç‚¹å‡»â€œç«‹å³å®‰è£…â€ï¼ˆé»˜è®¤å®‰è£…ï¼‰æˆ–è‡ªå®šä¹‰å®‰è£…è·¯å¾„ã€‚
- &emsp;å‹¾é€‰ç¬¬ä¸€å’Œç¬¬å››ä¸ªé€‰é¡¹ã€‚ç¬¬ä¸€ä¸ªé€‰é¡¹æ˜¯å®‰è£…åˆ°æ‰€æœ‰ç”¨æˆ·ã€‚ç¬¬å››ä¸ªé€‰é¡¹æ˜¯å®‰è£…ç¯å¢ƒå˜é‡ã€‚<br>
![images](images/05.png)
- (3).éªŒè¯å®‰è£…
- &emsp;æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼ˆWin + R â†’ è¾“å…¥ cmdï¼‰ï¼Œè¿è¡Œï¼š
```
python --version
```
- &emsp;å¦‚æœæ˜¾ç¤ºç‰ˆæœ¬å·ï¼ˆä¾‹å¦‚ Python 3.12.0ï¼‰ï¼Œåˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚

<! -- by æœä¿Šè¨€ --><br>
2.**ç¯å¢ƒé…ç½®**
-æ‰¾åˆ°åˆ°ç³»ç»Ÿå±æ€§â†’ ç¯å¢ƒå˜é‡ã€‚
-ç¼–è¾‘ç³»ç»ŸPATHå˜é‡å¹¶æ·»åŠ æ–°æ¡ç›®ï¼š
```
[æ‚¨çš„Pythonå®‰è£…è·¯å¾„]\Python\Scripts
```
-é…ç½®Visual Studioä»£ç ä»¥ä½¿ç”¨å·²å®‰è£…çš„Pythonè§£é‡Šå™¨ã€‚
ï»¿
3.**ä¾èµ–å…³ç³»å®‰è£…**
-æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼ˆWindows+Râ†’ é”®å…¥â€œcmdâ€ï¼‰ã€‚
-åœ¨å‘½ä»¤çª—å£è¿è¡Œï¼š
```
pip install -r requirements.txt
```
-*æ³¨æ„ï¼šå¦‚æœæ‚¨é‡åˆ°ä¸‹è½½é—®é¢˜ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨å…¶ä»–ç½‘ç»œè§£å†³æ–¹æ¡ˆ*

###è¿è¡Œåº”ç”¨ç¨‹åº<br>
ï»¿
1.åœ¨Visual Studioä»£ç ä¸­å¯åŠ¨`streamlit_mapp.py`ã€‚<br>

2.è®¿é—®èŠå¤©æœºå™¨äººçš„GitHubå­˜å‚¨åº“ç•Œé¢ã€‚<br>
![images](images/01.png)<br>

3.è¾“å…¥é¢„è®¾å¯†ç ï¼Œå¼€å§‹ä¸èŠå¤©æœºå™¨äººèŠå¤©ã€‚<br>
![images](images/02.png)<br>
   
*æ³¨æ„ï¼šæŸäº›åœ°åŒºçš„æœåŠ¡å¯ç”¨æ€§å¯èƒ½æœ‰é™*
<br>
<ï¼--byæ¨å¿—å‹‡ -->


## æ¨¡å—çš„è¯¦ç»†åŠŸèƒ½æè¿°å’Œå®ç°åˆ†æ

### æ¥å£åˆå§‹åŒ–å’Œç”¨æˆ·æŒ‡å¯¼
Â· ç•Œé¢æ ‡é¢˜å’Œæè¿°ï¼šä½¿ç”¨st.titleï¼ˆï¼‰å’Œst.writeï¼ˆï¼‰å‡½æ•°åˆ†åˆ«æ˜¾ç¤ºèŠå¤©æœºå™¨äººçš„æ ‡é¢˜å’Œæè¿°ï¼Œå¹¶å‘ç”¨æˆ·ä»‹ç»è¿™æ˜¯ä¸€ä¸ªåŸºäºOpenAI GPT-3.5æ¨¡å‹çš„ç®€å•èŠå¤©æœºå™¨äººï¼Œå¹¶ä¸”éœ€è¦æä¾›OpenAI APIå¯†é’¥æ‰èƒ½ä½¿ç”¨ã€‚
Â· è·å–APIå¯†é’¥ï¼šst.text_inputï¼ˆï¼‰åˆ›å»ºä¸€ä¸ªå®‰å…¨çš„æ–‡æœ¬è¾“å…¥æ¡†ï¼Œè¦æ±‚ç”¨æˆ·è¾“å…¥OpenAI APIå¯†é’¥ï¼Œè¾“å…¥å†…å®¹å°†ä»¥å¯†ç å½¢å¼éšè—ï¼Œä»¥ä¿æŠ¤ç”¨æˆ·å¯†é’¥çš„å®‰å…¨æ€§ã€‚
### Code demonstration
```import streamlit as st

# Show title and description
st.title("Chatbot")
st.write(
    "This is a simple chatbot that uses OpenAI's GPT-3.5 model to generate responses. "
    "To use this app, you need to provide an OpenAI API key, which you can get [here](https://platform.openai.com/account/api-keys). "
    "You can also learn how to build this app step by step by [following our tutorial](https://docs.streamlit.io/develop/tutorials/llms/build-conversational-apps)."
)
```

### ç”¨æˆ·è¾“å…¥éªŒè¯å’Œç•Œé¢é€»è¾‘
Â· APIå¯†é’¥éªŒè¯ï¼šé€šè¿‡if not openai_api_key:æ¡ä»¶ç¡®å®šç”¨æˆ·æ˜¯å¦è¾“å…¥äº†APIå¯†é’¥ã€‚å¦‚æœæ²¡æœ‰è¾“å…¥ï¼Œä½¿ç”¨st.infoï¼ˆï¼‰æ˜¾ç¤ºæç¤ºï¼Œå‘Šè¯‰ç”¨æˆ·éœ€è¦æ·»åŠ APIå¯†é’¥æ‰èƒ½ç»§ç»­ã€‚
Â· èŠå¤©ç•Œé¢å ä½ç¬¦ï¼šå¦‚æœç”¨æˆ·æä¾›äº†æœ‰æ•ˆçš„APIå¯†é’¥ï¼Œä½¿ç”¨passè¯­å¥ä¿ç•™ä½ç½®ï¼Œè¡¨ç¤ºåœ¨ç”¨æˆ·æä¾›APIå¯†é’¥åï¼Œä¸OpenAI APIäº¤äº’çš„åç»­èŠå¤©é€»è¾‘å°šæœªå®ç°ï¼Œéœ€è¦è¿›ä¸€æ­¥å¼€å‘ã€‚
### Code demonstration
```# Request the user to input the OpenAI API key via a text input box
openai_api_key = st.text_input("OpenAI API Key", type="password")
if not openai_api_key:
    st.info("Please add your OpenAI API key to continue.", icon="")
else:
    # If the API key exists, proceed to display the chat interface
    # This is a placeholder for the subsequent chat logic
    pass
```
<ï¼--byè¦ƒåŒ–æ° -->

å®‰å…¨è®¤è¯æ¨¡å—
åŠ¨æ€ API å¯†é’¥è¾“å…¥é€»è¾‘ openai_api_key = st.text_inputï¼ˆâ€œOpenAI API å¯†é’¥â€ï¼Œ type=â€œpasswordâ€ï¼‰
å®ç°é€»è¾‘ï¼š

å°† input type è®¾ç½®ä¸º â€œpasswordâ€ ä»¥éšè—çº¯æ–‡æœ¬ã€‚

æœªè¾“å…¥é”®æ—¶æ˜¾ç¤ºæŒ‡å—æç¤ºä¿¡æ¯ï¼ˆå›¾æ ‡ + æ–‡æœ¬ç»„åˆï¼‰ã€‚

å»ºè®®ä½¿ç”¨ secrets.to å°†å¯†é’¥å­˜å‚¨åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ã€‚

å®‰å…¨åŠŸèƒ½ï¼š API Key åŠ¨æ€è¾“å…¥ï¼šç”¨æˆ·å¯ä»¥é€šè¿‡ç•Œé¢åŠ¨æ€è¾“å…¥ API Keyã€‚

å¯†é’¥åŠ å¯†å­˜å‚¨ï¼šå¯†é’¥ä¸åº”ä»¥çº¯æ–‡æœ¬å½¢å¼å­˜å‚¨ã€‚å®ƒä»¬åº”ä»¥åŠ å¯†å½¢å¼å­˜å‚¨ä»¥å¢å¼ºå®‰å…¨æ€§ã€‚

æŒ‰é”®æ˜¾ç¤ºå’Œéšè—ï¼šè¾“å…¥æ—¶ï¼Œåº”éšè—æŒ‰é”®å†…å®¹ï¼Œä»¥é˜²æ­¢ä»–äººã€‚

å½“ç”¨æˆ·æœªè¾“å…¥ key æ—¶ï¼Œæ˜¾ç¤ºå¼•å¯¼æç¤ºä¿¡æ¯ï¼Œå¸®åŠ©ç”¨æˆ·å®Œæˆä½œã€‚

å®ç°é€»è¾‘

API å¯†é’¥çš„åŠ¨æ€è¾“å…¥ï¼š

import streamlit as st

API å¯†é’¥çš„åŠ¨æ€è¾“å…¥é€»è¾‘
api_key = st.text_inputï¼ˆâ€œOpenAI API å¯†é’¥â€ï¼Œ type=â€œpasswordâ€ï¼‰

ä½¿ç”¨ Streamlit çš„åŠŸèƒ½åˆ›å»ºä¸€ä¸ªå¯†ç è¾“å…¥æ¡†ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­è¾“å…¥ä»–ä»¬çš„ API å¯†é’¥ã€‚text_input

â€œtype=â€passwordâ€œâ€ å‚æ•°ç¡®ä¿è¾“å…¥çš„å†…å®¹ä»¥å¯†æ–‡å½¢å¼æ˜¾ç¤ºï¼Œä»è€Œå¢å¼ºå®‰å…¨æ€§ã€‚

å¯†é’¥åŠ å¯†å­˜å‚¨ï¼š
å»ºè®®ä½¿ç”¨ secrets æ¨¡å—æ¥å­˜å‚¨å’Œç®¡ç†å¯†é’¥ã€‚secrets æ¨¡å—æ˜¯ Python ä¸­çš„å†…ç½®æ¨¡å—ï¼Œä¸“é—¨ç”¨äºå¤„ç†æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç å’Œå¯†é’¥ã€‚

import secrets

Generate an encrypted key
encrypted_api_key = secrets.token_urlsafe(16)

Store the encrypted key (This is just an example. The actual storage method should be determined based on the security requirements of the production environment)
Do not print or expose the key directly in a real scenario
print("Encrypted API Key:", encrypted_api_key)
é”®éšè—/æ˜¾ç¤ºï¼š

å·²ç»é€šè¿‡ type=â€œpasswordâ€ å®ç°äº†ï¼Œè¾“å…¥æ¡†ä¸­çš„å†…å®¹ä¼šä»¥å¯†æ–‡çš„å½¢å¼æ˜¾ç¤ºã€‚

é”®éšè—/æ˜¾ç¤ºï¼š

å·²ç»é€šè¿‡ type=â€œpasswordâ€ å®ç°äº†ï¼Œè¾“å…¥æ¡†ä¸­çš„å†…å®¹ä¼šä»¥å¯†æ–‡çš„å½¢å¼æ˜¾ç¤ºã€‚

å¼•å¯¼æç¤ºä¿¡æ¯ï¼š

å½“ç”¨æˆ·å°šæœªè¾“å…¥å¯†é’¥æ—¶ï¼Œæ˜¾ç¤ºæŒ‡å¯¼æç¤ºæ¶ˆæ¯å’Œå›¾æ ‡ã€‚

å¦‚æœä¸api_keyï¼š st.warningï¼ˆ'è¯·è¾“å…¥æ‚¨çš„ OpenAI API å¯†é’¥ä»¥ç»§ç»­ã€‚'ï¼‰ st.imageï¼ˆ'path_to_icon.png'ï¼‰ # æ›¿æ¢ä¸ºå›¾æ ‡çš„å®é™…è·¯å¾„

ç”Ÿäº§ç¯å¢ƒ

åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä½¿ç”¨ secrets.to å­˜å‚¨å¯†é’¥ï¼Œä»¥ä¿è¯å¯†é’¥çš„å®‰å…¨æ€§å’Œéšç§æ€§ã€‚

<ï¼--byç½—å…¨æœ‰ -->



python
Copy Code
# ä¼šè¯çŠ¶æ€åˆå§‹åŒ–ä¸ç»´æŠ¤
if "messages" not in st.session_state:
    st.session_state.messages = []
â€Œæ ¸å¿ƒæœºåˆ¶â€Œ
åˆ©ç”¨ Streamlit çš„å“åº”å¼ç¼–ç¨‹ç‰¹æ€§è‡ªåŠ¨åŒæ­¥çŠ¶æ€
æ¶ˆæ¯å†å²é‡‡ç”¨åˆ—è¡¨ç»“æ„å­˜å‚¨è§’è‰²(content/role)å…ƒæ•°æ®
åˆ·æ–°é¡µé¢æ—¶é€šè¿‡å†…å­˜æŒä¹…åŒ–ä¿æŒå¯¹è¯è¿ç»­æ€§

åŠŸèƒ½æ‰©å±•ï¼š

æŒä¹…åŒ–å­˜å‚¨ï¼š
æ·»åŠ JSONæ–‡ä»¶å­˜å‚¨åŠŸèƒ½ï¼Œå®ç°æµè§ˆå™¨é‡å¯åçš„å¯¹è¯è®°å¿†
å®ç°save_conversation()å‡½æ•°ç”¨äºæ•°æ®æŒä¹…åŒ–
ä½¿ç”¨atexitç¡®ä¿è„šæœ¬ç»ˆæ­¢æ—¶æ•°æ®ä¿å­˜

ç”¨æˆ·ç•Œé¢å…ƒç´ ï¼š
å¢åŠ æ–‡æœ¬è¾“å…¥æ¡†å’Œå‘é€æŒ‰é’®ç”¨äºæ¶ˆæ¯ç¼–è¾‘
ä½¿ç”¨Streamlitçš„st.chat_messageå®ç°åŸºç¡€èŠå¤©ç•Œé¢å¸ƒå±€

æ¶ˆæ¯å¤„ç†ï¼š
åˆ›å»ºå¸¦è§’è‰²åŒºåˆ†ï¼ˆç”¨æˆ·/åŠ©æ‰‹ï¼‰çš„æ¶ˆæ¯å¯¹è±¡
æ·»åŠ å ä½ç¬¦å“åº”ç”Ÿæˆå‡½æ•°
å®ç°è¾“å…¥éªŒè¯å’Œå­—æ®µæ¸…ç†æœºåˆ¶

æ¨¡å—åŒ–è®¾è®¡ï¼š
å°†ä¸åŒåŠŸèƒ½æ‹†åˆ†åˆ°ç‹¬ç«‹å‡½æ•°ï¼ˆæŒä¹…åŒ–ã€å“åº”ç”Ÿæˆï¼‰
ä½¿ç”¨å¸¸é‡å®šä¹‰å­˜å‚¨æ–‡ä»¶è·¯å¾„
ä¸ºæ¯ä¸ªåŠŸèƒ½æ·»åŠ æ–‡æ¡£æ³¨é‡Š

å¯æ‰©å±•æ€§ï¼š
å“åº”ç”Ÿæˆå™¨å¯æ›¿æ¢ä¸ºAPIè°ƒç”¨æˆ–æœºå™¨å­¦ä¹ æ¨¡å‹
å­˜å‚¨æœºåˆ¶å¯é€‚é…æ•°æ®åº“é›†æˆ
æ”¯æŒæ‰©å±•å¤šæ¶ˆæ¯å±æ€§ï¼ˆæ—¶é—´æˆ³ç­‰ï¼‰

<ï¼--byé‚“è£ç¥¥ -->


# æ¶ˆæ¯æ¸²æŸ“æ¨¡å—çš„è¯¦ç»†åŠŸèƒ½æè¿°ä¸å®ç°åˆ†æ

åœ¨è¿™æ¬¾èŠå¤©æœºå™¨äººåº”ç”¨ä¸­ï¼Œæ¶ˆæ¯æ¸²æŸ“æ˜¯ç¡®ä¿ç”¨æˆ·ä¸åŠ©æ‰‹ä¹‹é—´é¡ºç•…ä¸”æ˜“äºç†è§£çš„æ²Ÿé€šçš„å…³é”®éƒ¨åˆ†ã€‚æœ‰æ•ˆçš„æ¶ˆæ¯æ¸²æŸ“èƒ½å¤Ÿæå‡ç”¨æˆ·ä½“éªŒå¹¶æ¸…æ™°åœ°ä¼ è¾¾ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯æ¶ˆæ¯æ¸²æŸ“çš„ä¸»è¦ç»„æˆéƒ¨åˆ†åŠå…¶è¯¦ç»†è¯´æ˜ã€‚

## ä»£ç ç‰‡æ®µåŠè¯´æ˜

### 1. æ˜¾ç¤ºç°æœ‰èŠå¤©æ¶ˆæ¯
è¿™æ®µä»£ç ä» `st.session_state.messages` ä¸­æ£€ç´¢å¹¶æ˜¾ç¤ºä¹‹å‰çš„èŠå¤©æ¶ˆæ¯ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿå›é¡¾ä»–ä»¬çš„å¯¹è¯å†å²ã€‚

```python
for message in st.session_state.messages:
    with st.chat_message(message["role"]):
        st.markdown(message["content"])
```

- **éå†æ¶ˆæ¯**ï¼š
  - `for message in st.session_state.messages:` è¿™è¡Œä»£ç éå†å­˜å‚¨åœ¨ä¼šè¯çŠ¶æ€ä¸­çš„æ‰€æœ‰æ¶ˆæ¯ã€‚
  - `st.session_state` æ˜¯ Streamlit æä¾›çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œç”¨äºåœ¨ç”¨æˆ·ä¼šè¯ä¸­ä¿æŒæ•°æ®ï¼Œç¡®ä¿ä¹‹å‰çš„èŠå¤©æ¶ˆæ¯å¯ä»¥è¢«è®¿é—®ã€‚

- **æ¸²æŸ“æ¶ˆæ¯**ï¼š
  - `with st.chat_message(message["role"]):` è¿™è¡Œä»£ç ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ ¹æ®æ¶ˆæ¯çš„è§’è‰²ï¼ˆå¯ä»¥æ˜¯â€œç”¨æˆ·â€æˆ–â€œåŠ©æ‰‹â€ï¼‰æ¥æ¸²æŸ“æ¯æ¡æ¶ˆæ¯ã€‚
  - è¿™ç§åŒºåˆ†æœ‰åŠ©äºåœ¨è§†è§‰ä¸Šå°†æ¶ˆæ¯åˆ†å¼€ï¼Œè®©ç”¨æˆ·æ¸…æ¥šåœ°çŸ¥é“æ˜¯è°åœ¨è¯´è¯ã€‚

- **æ˜¾ç¤ºå†…å®¹**ï¼š
  - `st.markdown(message["content"])` è¿™è¡Œä»£ç ä½¿ç”¨ Streamlit çš„ `st.markdown` æ–¹æ³•æ¥æ¸²æŸ“æ¶ˆæ¯å†…å®¹ã€‚
  - è¿™å…è®¸ä½¿ç”¨åŸºæœ¬çš„ Markdown æ ¼å¼ï¼Œä½¿æ¶ˆæ¯æ›´æ˜“äºé˜…è¯»ä¸”æ›´å…·å¸å¼•åŠ›ã€‚

### 2. å­˜å‚¨å’Œæ˜¾ç¤ºç”¨æˆ·è¾“å…¥
å½“ç”¨æˆ·æäº¤ä¸€æ¡æ–°æ¶ˆæ¯æ—¶ï¼Œå°†æ‰§è¡Œä»¥ä¸‹ä»£ç æ¥å­˜å‚¨å’Œæ˜¾ç¤ºè¾“å…¥ï¼š

```python
st.session_state.messages.append({"role": "user", "content": prompt})
with st.chat_message("user"):
    st.markdown(prompt)
```

- **å­˜å‚¨ç”¨æˆ·è¾“å…¥**ï¼š
  - `st.session_state.messages.append({"role": "user", "content": prompt})` è¿™è¡Œä»£ç å°†ç”¨æˆ·è¾“å…¥ï¼ˆå­˜å‚¨åœ¨å˜é‡ `prompt` ä¸­ï¼‰æ·»åŠ åˆ° `st.session_state.messages` åˆ—è¡¨ä¸­ã€‚

- **æ¸²æŸ“ç”¨æˆ·æ¶ˆæ¯**ï¼š
  - `with st.chat_message("user"):` è¿™è¡Œä»£ç ä¸ºæ¸²æŸ“ç”¨æˆ·æ¶ˆæ¯åˆ›å»ºäº†ä¸€ä¸ªä¸Šä¸‹æ–‡ã€‚
  - è¿™ç¡®ä¿äº†æ¶ˆæ¯ä»¥ç”¨æˆ·æ¶ˆæ¯çš„é€‚å½“æ ¼å¼æ˜¾ç¤ºåœ¨èŠå¤©ç•Œé¢ä¸­ã€‚

- **æ˜¾ç¤ºå†…å®¹**ï¼š
  - `st.markdown(prompt)` è¿™è¡Œä»£ç ä½¿ç”¨ Streamlit çš„ `st.markdown` æ–¹æ³•åœ¨èŠå¤©çª—å£ä¸­æ¸²æŸ“ç”¨æˆ·è¾“å…¥ã€‚
  - è¿™å…è®¸ä½¿ç”¨åŸºæœ¬çš„ Markdown æ ¼å¼ï¼Œä½¿æ¶ˆæ¯æ›´å…·è§†è§‰å¸å¼•åŠ›ä¸”æ›´æ˜“äºé˜…è¯»ã€‚

### 3. æ˜¾ç¤ºåŠ©æ‰‹å›å¤
åŠ©æ‰‹ç”Ÿæˆå›å¤åï¼Œå°†ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š

```python
with st.chat_message("assistant"):
    response = st.write_stream(stream)
```

- **æ¸²æŸ“åŠ©æ‰‹æ¶ˆæ¯**ï¼š
  - `with st.chat_message("assistant"):` è¿™è¡Œä»£ç ä¸ºæ¸²æŸ“åŠ©æ‰‹çš„æ¶ˆæ¯åˆ›å»ºäº†ä¸€ä¸ªä¸Šä¸‹æ–‡ã€‚
  - è¿™ç¡®ä¿äº†æ¶ˆæ¯åœ¨èŠå¤©ç•Œé¢ä¸­æ­£ç¡®æ˜¾ç¤ºï¼Œå¹¶ä¸”ä»¥åŠ©æ‰‹è§’è‰²çš„é€‚å½“æ ¼å¼è¿›è¡Œæ ¼å¼åŒ–ã€‚

- **æµå¼å“åº”**ï¼š
  - `response = st.write_stream(stream)` è¿™è¡Œä»£ç ä½¿ç”¨ `st.write_stream` æ–¹æ³•é€æ­¥æ˜¾ç¤ºåŠ©æ‰‹çš„å›å¤ã€‚
  - è¿™ç§æ–¹æ³•é€šè¿‡è®©ç”¨æˆ·èƒ½å¤Ÿå®æ—¶çœ‹åˆ°å›å¤çš„ç”Ÿæˆè¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ç­‰å¾…æ•´ä¸ªæ¶ˆæ¯ä¸€æ¬¡æ€§å‡ºç°ï¼Œä»è€Œå¢å¼ºäº†ç”¨æˆ·ä½“éªŒï¼Œä½¿å¯¹è¯æ„Ÿè§‰æ›´åŠ åŠ¨æ€å’Œè‡ªç„¶ã€‚
  - 
<ï¼--byé»„æ•åˆ -->

# è¾“å…¥å¤„ç†æ¨¡å—

åœ¨è¯¥åº”ç”¨ä¸­ï¼Œè¾“å…¥å¤„ç†æ¨¡å—è´Ÿè´£è·å–ç”¨æˆ·çš„OpenAI APIå¯†é’¥å’Œç”¨æˆ·è¾“å…¥çš„èŠå¤©æ¶ˆæ¯ã€‚ä»¥ä¸‹æ˜¯ç›¸å…³ä»£ç åŠè¯¦ç»†è¯´æ˜ã€‚
## ä»£ç 

```python
# Ask user for their OpenAI API key via `st.text_input`.
openai_api_key = st.text_input("OpenAI API Key", type="password")
if not openai_api_key:
    st.info("Please add your OpenAI API key to continue.", icon="ğŸ—ï¸")
else:
    # Create an OpenAI client.
    client = OpenAI(api_key=openai_api_key)

    # Create a session state variable to store the chat messages. This ensures that the
    # messages persist across reruns.
    if "messages" not in st.session_state:
        st.session_state.messages = []

    # Display the existing chat messages via `st.chat_message`.
    for message in st.session_state.messages:
        with st.chat_message(message["role"]):
            st.markdown(message["content"])

    # Create a chat input field to allow the user to enter a message. This will display
    # automatically at the bottom of the page.
    if prompt := st.chat_input("What is up?"):
        # Store and display the current prompt.
        st.session_state.messages.append({"role": "user", "content": prompt})
        with st.chat_message("user"):
            st.markdown(prompt)
```
## 1. è·å–OpenAI APIå¯†é’¥:
```
openai_api_key = st.text_input("OpenAI API Key", type="password")
```
- ä½¿ç”¨st.text_inputåˆ›å»ºä¸€ä¸ªè¾“å…¥æ¡†ï¼Œæç¤ºç”¨æˆ·è¾“å…¥OpenAI APIå¯†é’¥ã€‚type="password"å‚æ•°ç¡®ä¿è¾“å…¥å†…å®¹ä»¥å¯†ç å½¢å¼éšè—æ˜¾ç¤ºã€‚
## 2. éªŒè¯APIå¯†é’¥æœ‰æ•ˆæ€§:
```
if not openai_api_key:
    st.info("Please add your OpenAI API key to continue.", icon="ğŸ—ï¸")
```
- å¦‚æœç”¨æˆ·æœªè¾“å…¥APIå¯†é’¥ï¼Œä½¿ç”¨st.infoæç¤ºç”¨æˆ·éœ€è¦æ·»åŠ å¯†é’¥æ‰èƒ½ç»§ç»­ä½¿ç”¨ã€‚
## 3. åˆ›å»ºOpenAIå®¢æˆ·ç«¯:
```
client = OpenAI(api_key=openai_api_key)
```
- å½“ç”¨æˆ·æä¾›æœ‰æ•ˆçš„APIå¯†é’¥åï¼Œä½¿ç”¨è¯¥å¯†é’¥åˆ›å»ºOpenAIå®¢æˆ·ç«¯å®ä¾‹ï¼Œç”¨äºåç»­çš„APIè°ƒç”¨ã€‚
## 4. åˆ›å»ºèŠå¤©è¾“å…¥æ¡†:
```
if prompt := st.chat_input("What is up?"):
```
- ä½¿ç”¨st.chat_inputåˆ›å»ºæ¶ˆæ¯è¾“å…¥æ¡†ï¼Œå…è®¸ç”¨æˆ·è¾“å…¥èŠå¤©å†…å®¹ã€‚å½“ç”¨æˆ·è¾“å…¥æ¶ˆæ¯åï¼Œå†…å®¹ä¼šå­˜å‚¨åœ¨promptå˜é‡ä¸­ã€‚
## 5. å­˜å‚¨å¹¶æ˜¾ç¤ºç”¨æˆ·è¾“å…¥:
```
st.session_state.messages.append({"role": "user", "content": prompt})
with st.chat_message("user"):
    st.markdown(prompt)
```
- å°†ç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯æ·»åŠ åˆ°ä¼šè¯çŠ¶æ€çš„messagesåˆ—è¡¨ä¸­ï¼Œå¹¶ä½¿ç”¨st.chat_messageæ˜¾ç¤ºè¯¥æ¶ˆæ¯ã€‚

<! -- by éŸ¦ç»Ÿ -->
